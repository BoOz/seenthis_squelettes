#CACHE{0}

<BOUCLE_principale(AUTEURS){tout}{id_auteur=#ENV{id}}>
		#SET{messages, #ARRAY{}}
		#SET{off, #ARRAY{}}

		<BOUCLE_share(spip_me_share){id_auteur}{0,100}{par date}{inverse}>
			[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
		</BOUCLE_share>

	
		<BOUCLE_messages_perso(spip_me){id_auteur}{par date}{inverse}{doublons}{statut=publi}> 
				[(#ID_PARENT|>{0}|?{" ",""})
					[(#SET{messages, #GET{messages}|push{#ID_PARENT}})]		
				]
				[(#ID_PARENT|>{0}|?{""," "})
					[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
				]
		</BOUCLE_messages_perso>
		
		<BOUCLE_liens_vers_moi(spip_me spip_me_auteur){spip_me_auteur.id_auteur=#ID_AUTEUR}{spip_me.statut=publi}{par date}{inverse}{doublons}{0,100}>
				[(#ID_PARENT|>{0}|?{" ",""})
					[(#SET{messages, #GET{messages}|push{#ID_PARENT}})]		
				]
				[(#ID_PARENT|>{0}|?{""," "})
					[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
				]
		</BOUCLE_liens_vers_moi>
	

		#SET{auteurs_suivis, #ARRAY{}}
		<BOUCLE_follow(spip_me_follow){id_follow=#ENV{id}}>
			[(#SET{auteurs_suivis, #GET{auteurs_suivis}|push{#ID_AUTEUR}})]		
		</BOUCLE_follow>
		
		<BOUCLE_messages_follow(ME){id_auteur IN #GET{auteurs_suivis}}{id_parent=0}{0,200}{par date}{inverse}>
				[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
		</BOUCLE_messages_follow>

		<BOUCLE_messages_follow_reponses(ME){id_auteur IN #GET{auteurs_suivis}}{id_parent>0}{0,50}{par date}{inverse}>
				[(#SET{messages, #GET{messages}|push{#ID_PARENT}})]		
		</BOUCLE_messages_follow_reponses>

		<BOUCLE_share_follow(spip_me_share){id_auteur IN #GET{auteurs_suivis}}{0,100}>
			[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
		</BOUCLE_share_follow>
	

	
	
		[(#REM) Les mots qu'on suit ]
		<BOUCLE_follow_mot(spip_me_follow_mot){id_follow=#ID_AUTEUR}>
			<BOUCLE_le_mot(MOTS){id_mot=#ID_MOT}{doublons mots}>
				<BOUCLE_enfants(MOTS){id_parent=#ID_MOT}{tout}{doublons mots}>
					<BOUCLE_enfants2(BOUCLE_enfants){tout}{doublons mots} />
				</BOUCLE_enfants>
			</BOUCLE_le_mot>

			<BOUCLE_sites(spip_syndic_oc){id_mot=#ID_MOT}>
				<BOUCLE_tous_liens_site(spip_me spip_me_syndic){spip_me_syndic.id_syndic=#ID_SYNDIC}>
					[(#ID_PARENT|>{0}|?{" ",""})
						[(#SET{messages, #GET{messages}|push{#ID_PARENT}})]		
					]
					[(#ID_PARENT|>{0}|?{""," "})
						[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
					]
				</BOUCLE_tous_liens_site>
			</BOUCLE_sites>
		</BOUCLE_follow_mot>

		<BOUCLE_tous_mots(MOTS){tout}{!doublons mots}>
			<BOUCLE_tous_liens(spip_me spip_me_mot){spip_me_mot.id_mot=#ID_MOT}{spip_me.statut=publi}>
				[(#ID_PARENT|>{0}|?{" ",""})
					[(#SET{messages, #GET{messages}|push{#ID_PARENT}})]		
				]
				[(#ID_PARENT|>{0}|?{""," "})
					[(#SET{messages, #GET{messages}|push{#ID_ME}})]		
				]
			</BOUCLE_tous_liens>
		</BOUCLE_tous_mots>
		
	
		<B_messages>
		[<div class="pagination" id="pagination_haut">(#PAGINATION)</div>]
		<ul id="messages">
		<BOUCLE_messages(spip_me){id_me IN #GET{messages}}{par date}{inverse}{id_parent=0}{pagination 25}{statut=publi}>
			<li id="message#ID_ME">
				[(#ID_ME|microcache{noisettes/afficher_message})]
			</li>
		</BOUCLE_messages>
		</ul>
		[<div class="pagination" id="pagination_bas">(#PAGINATION)</div>]
		</B_messages>
		<ul id="messages">
			<li>Pas encore de messages</li>
		</ul>	
		<//B_messages>
		
</BOUCLE_principale>